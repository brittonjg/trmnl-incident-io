{% comment %}
  Incident.io Active Incidents - Full Screen Layout
  Displays incident statistics and detailed incident list
{% endcomment %}

{% assign max_display = max_incidents | default: 5 %}
{% assign incidents_to_show = incidents | slice: 0, max_display %}

<div class="layout layout--col gap--space-between">

  <!-- Status Summary Cards -->
  <div class="grid grid--cols-3 gap--medium">
    {% render "metric_card", value: active_count, label: 'Active', centered: false %}
    {% render "metric_card", value: critical_count, label: 'Critical', centered: false %}
    {% render "metric_card", value: closed_count, label: 'Resolved', centered: false %}
  </div>

  <!-- Incidents List -->
  <div class="grid grid--cols-1 gap--small mt--2.5">
    {% if incidents_to_show.size > 0 %}
      {% for incident in incidents_to_show %}
        <div class="item pl--2" style="border-left: {% if incident.severity.name == 'P1' %}4px solid #000000{% elsif incident.severity.name == 'P2' %}3px solid #000000{% elsif incident.severity.name contains 'P' %}2px solid #000000{% else %}1px solid #000000{% endif %};">
          <div class="content">
            <div class="title--small text--black font-bold mb--1" style="line-height: 1.3;">
              {{ incident.name | truncate: 50 }}
            </div>
            <div class="label text--black font-bold" style="line-height: 1.5;">
              {{ incident.incident_type.name }} • {{ incident.incident_status.name }} •
              {% render "severity_badge", severity: incident.severity, size: 'normal' %}
            </div>
          </div>
          {% comment %} Show impact information {% endcomment %}
          <div class="flex flex--wrap gap--[4px] mt--1.5 text--black" style="line-height: 1.5;">
            {% for field in incident.custom_field_entries %}
              {% render "impact_badge_teams", field: field, limit: 3, size: 'normal' %}
              {% render "impact_badge_services", field: field, limit: 3, size: 'normal' %}
              {% render "impact_badge_users", field: field, size: 'normal' %}
            {% endfor %}
          </div>
        </div>
      {% endfor %}
    {% else %}
      {% render "empty_state", size: 'large' %}
    {% endif %}
  </div>

</div>

<!-- Title Bar -->
<div class="title_bar">
  <img class="image" src="https://cdn.brandfetch.io/idBR-MZuZU/w/400/h/400/theme/dark/icon.jpeg">
  <span class="title">Incident.io</span>
  <span class="instance">
    {% if active_count == 1 %}
      1 Active Incident
    {% elsif active_count > 1 %}
      {{ active_count }} Active Incidents
    {% else %}
      All Clear
    {% endif %}
  </span>
</div>
